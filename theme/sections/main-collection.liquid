{% comment %}
  Main Collection Section - Shopify 2.0
  Displays collection products with filtering and pagination
{% endcomment %}

<div class="collection-wrapper">
  {% paginate collection.products by section.settings.products_per_page %}

    <div class="collection-header">
      <h1>{{ collection.title }}</h1>
      <p>{{ collection.products_count }} {% if collection.products_count == 1 %}piece{% else %}pieces{% endif %}</p>
      {% if section.settings.show_description and collection.description != blank %}
        <div class="collection-description">
          {{ collection.description }}
        </div>
      {% endif %}
    </div>

    <div class="collection-container">
      <!-- Sidebar Filters -->
      {% if section.settings.enable_filtering %}
        <aside class="collection-sidebar" data-sidebar>
          <button class="filter-toggle-mobile" data-filter-toggle>
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <line x1="21" x2="14" y1="4" y2="4"></line>
              <line x1="10" x2="3" y1="4" y2="4"></line>
              <line x1="21" x2="12" y1="12" y2="12"></line>
              <line x1="8" x2="3" y1="12" y2="12"></line>
            </svg>
            Filter & Sort
          </button>

          <div class="sidebar-section">
            <h3>Sort By</h3>
            <ul class="filter-list">
              <li>
                <a href="{{ collection.url }}?sort_by=created-descending" {% if collection.sort_by == 'created-descending' or collection.sort_by == blank %}class="active"{% endif %}>
                  Newest
                </a>
              </li>
              <li>
                <a href="{{ collection.url }}?sort_by=price-ascending" {% if collection.sort_by == 'price-ascending' %}class="active"{% endif %}>
                  Price: Low to High
                </a>
              </li>
              <li>
                <a href="{{ collection.url }}?sort_by=price-descending" {% if collection.sort_by == 'price-descending' %}class="active"{% endif %}>
                  Price: High to Low
                </a>
              </li>
            </ul>
          </div>

          <button class="sidebar-close" data-sidebar-close>
            Apply Filters
          </button>
        </aside>
      {% endif %}

      <!-- Products Grid -->
      <div class="collection-products">
        {% if collection.products.size > 0 %}
          <div class="products-grid" style="grid-template-columns: repeat({{ section.settings.products_per_row }}, 1fr);">
            {% for product in collection.products %}
              {% render 'product-card', product: product %}
            {% endfor %}
          </div>

          {% if paginate.pages > 1 %}
            <div class="pagination">
              {% if paginate.previous %}
                <a href="{{ paginate.previous.url }}" class="pagination-btn">Previous</a>
              {% endif %}

              {% for part in paginate.parts %}
                {% if part.is_link %}
                  <a href="{{ part.url }}" class="pagination-number">{{ part.title }}</a>
                {% else %}
                  {% if part.title == paginate.current_page %}
                    <span class="pagination-number active">{{ part.title }}</span>
                  {% else %}
                    <span class="pagination-number">{{ part.title }}</span>
                  {% endif %}
                {% endif %}
              {% endfor %}

              {% if paginate.next %}
                <a href="{{ paginate.next.url }}" class="pagination-btn">Next</a>
              {% endif %}
            </div>
          {% endif %}
        {% else %}
          <div class="no-products">
            <p>No products found in this collection.</p>
            <a href="/collections/all" class="btn-primary">Browse All Products</a>
          </div>
        {% endif %}
      </div>
    </div>

  {% endpaginate %}
</div>

<style>
.collection-wrapper {
  padding-top: 60px;
  min-height: 100vh;
}

.collection-header {
  text-align: center;
  padding: 3rem 2rem 2rem;
  border-bottom: 2px solid var(--color-border);
}

.collection-header h1 {
  font-size: 1rem;
  font-weight: 700;
  letter-spacing: 0;
  text-transform: uppercase;
  margin: 0 0 0.5rem;
}

.collection-header p {
  font-size: 0.8rem;
  color: var(--color-muted);
  margin-bottom: 1rem;
}

.collection-description {
  max-width: 600px;
  margin: 1rem auto 0;
  font-size: 0.875rem;
  line-height: 1.6;
  color: var(--color-muted);
}

.collection-container {
  display: grid;
  grid-template-columns: 200px 1fr;
  max-width: 100%;
  margin: 0 auto;
  padding: 2rem 3rem;
  gap: 3rem;
}

.filter-toggle-mobile {
  display: none;
  align-items: center;
  gap: 0.5rem;
  padding: 0.65rem 1rem;
  background: var(--color-bg);
  border: 1px solid var(--color-border);
  font-size: 0.75rem;
  font-weight: 500;
  text-transform: uppercase;
  cursor: pointer;
  position: fixed;
  bottom: 1.5rem;
  left: 50%;
  transform: translateX(-50%);
  z-index: 50;
}

.collection-sidebar {
  position: sticky;
  top: 80px;
  height: fit-content;
}

.sidebar-section {
  margin-bottom: 2rem;
}

.sidebar-section h3 {
  font-size: 0.875rem;
  font-weight: 700;
  text-transform: uppercase;
  margin: 0 0 1rem;
}

.filter-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.filter-list li {
  margin-bottom: 0.35rem;
}

.filter-list a {
  padding: 0.25rem 0;
  font-size: 0.875rem;
  color: var(--color-muted);
  text-decoration: none;
  display: block;
}

.filter-list a:hover,
.filter-list a.active {
  color: var(--color-text);
  text-decoration: underline;
}

.sidebar-close {
  display: none;
}

.collection-products {
  min-height: 50vh;
}

.products-grid {
  display: grid;
  gap: 2rem;
}

.no-products {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 40vh;
  gap: 1.5rem;
  color: var(--color-muted);
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 0.5rem;
  margin-top: 3rem;
  padding-top: 2rem;
  border-top: 1px solid var(--color-border);
}

.pagination-btn,
.pagination-number {
  padding: 0.5rem 0.75rem;
  border: 1px solid var(--color-border);
  background: var(--color-bg);
  color: var(--color-text);
  text-decoration: none;
  font-size: 0.875rem;
}

.pagination-number.active {
  background: var(--color-text);
  color: var(--color-bg);
}

@media (max-width: 1024px) {
  .products-grid {
    grid-template-columns: repeat(2, 1fr) !important;
  }
}

@media (max-width: 768px) {
  .collection-container {
    display: block;
    padding: 1.5rem;
  }

  .filter-toggle-mobile {
    display: flex;
  }

  .collection-sidebar {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--color-bg);
    z-index: 150;
    padding: 5rem 2rem 2rem;
    overflow-y: auto;
    transform: translateX(-100%);
    transition: transform 0.3s ease;
  }

  .collection-sidebar.open {
    transform: translateX(0);
  }

  .sidebar-close {
    display: block;
    position: fixed;
    bottom: 1.5rem;
    left: 2rem;
    right: 2rem;
    padding: 0.875rem;
    background: var(--color-text);
    color: var(--color-bg);
    border: none;
    font-size: 0.7rem;
    font-weight: 500;
    text-transform: uppercase;
    cursor: pointer;
  }

  .products-grid {
    gap: 1rem;
  }
}

@media (max-width: 480px) {
  .collection-header {
    padding: 2rem 1rem 1.5rem;
  }
}
</style>

{% schema %}
{
  "name": "Collection Page",
  "tag": "section",
  "class": "main-collection",
  "settings": [
    {
      "type": "header",
      "content": "Collection Display"
    },
    {
      "type": "checkbox",
      "id": "show_description",
      "label": "Show Collection Description",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_filtering",
      "label": "Enable Filtering Sidebar",
      "default": true
    },
    {
      "type": "header",
      "content": "Product Grid"
    },
    {
      "type": "range",
      "id": "products_per_row",
      "min": 2,
      "max": 4,
      "step": 1,
      "label": "Products Per Row",
      "default": 3
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 12,
      "max": 48,
      "step": 12,
      "label": "Products Per Page",
      "default": 24
    }
  ]
}
{% endschema %}
